WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:loader', location = 'loader.chunk.js' */
(window.atlassianWebpackJsonp77bd9c8b87e6dc89db026400e110f339=window.atlassianWebpackJsonp77bd9c8b87e6dc89db026400e110f339||[]).push([["loader"],{"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/common/common.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,'.ic-sidebar .ic-sidebar-heading{background-color:#fff;height:16px;margin:10px 17px 0;position:relative}.ic-sidebar .ic-sidebar-heading .ic-right-toolbar{float:right;margin-right:-3px;margin-top:-4px}.ic-sidebar .ic-sidebar-heading .ic-right-toolbar a.ic-action-menu{margin-right:5px}.ic-sidebar .ic-sidebar-heading .ic-right-toolbar a.ic-action-menu span{color:#707070}.ic-sidebar .ic-sidebar-heading .ic-right-toolbar .ic-action-hide{float:right;margin-left:5px;margin-top:4px}.ic-sidebar .ic-sidebar-heading .aui-button-text{color:#344563}.ic-sidebar .ic-sidebar-heading .aui-button-text:active,.ic-sidebar .ic-sidebar-heading .aui-button-text:focus,.ic-sidebar .ic-sidebar-heading .aui-button-text:hover{text-decoration:none}.ic-comment-container{background-color:#fff;border-bottom:1px solid #ccc;border-left:4px solid #f6c342;border-top:1px solid #ccc}.ic-comment-container.ic-deleted,.ic-comment-container.ic-resolved{border-left:1px solid #ccc;padding-left:3px}.ic-author{font-weight:700;line-height:24px;padding-top:10px;vertical-align:middle}.ic-author .ic-author-avatar{float:left;margin:0 5px 0 0}.ic-author .url{display:inline-block;max-width:212px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ic-actions{line-height:16px;margin-top:10px}.ic-actions .aui-button{font-size:12px;height:16px}.ic-actions ul{display:inline;padding:0;width:100%}.ic-actions ul li{display:inline-block;list-style-type:none}.ic-actions ul li:last-child:after{display:none}.ic-actions ul li:after{color:#707070;content:"â€¢";font-size:12px;padding:0 3px}.ic-actions .aui-button.aui-button-link{border:none;color:#707070;padding:0}',""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/confirm-dialog/confirm-dialog.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,".ic-confirm-label{color:#707070;text-transform:uppercase}.ic-confirm-message{color:#707070;padding-bottom:5px}.ic-confirm-container{background-color:#fff;border:1px solid #f5f5f5;box-shadow:0 3px 6px #0003;font-weight:400;max-width:150px;overflow-y:auto;padding:20px;position:absolute;right:18px;text-transform:none;top:18px;z-index:1}.ic-action-menu.ic-action-menu-active{background-color:#f2f2f2;background-image:none;border-color:#ccc;box-shadow:inset 0 3px 6px #0000001a;text-decoration:none;text-shadow:none}",""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/create-comment/create-comment.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,".ic-create-comment-view .ic-create-comment{margin:0 18px 0 17px}.ic-create-comment-view .ic-body{margin:5px 0 0}.ic-create-comment-view .ic-body .loading-container{height:20px}.ic-create-comment-view .ic-body #anonymous-warning{margin-bottom:10px}.ic-create-comment-view .aui-button-link.ic-action-save{font-size:12px;line-height:20px}.ic-create-comment-view .textarea.ic-textarea{height:80px}.ic-create-comment-view #rte-savebar{background-color:initial;border:0;box-shadow:none;padding:5px 0 0}.ic-create-comment-view #rte-savebar .save-button-container{margin-right:0}.ic-create-comment-view #rte-savebar #rte-button-cancel{margin-left:10px}.ic-create-comment-view #rte-savebar #rte-savebar-tinymce-plugin-point,.ic-create-comment-view #rte-savebar .toolbar-group-edit,.ic-create-comment-view #rte-savebar .toolbar-group-preview{display:none}.ic-create-comment-view #rte-spinner{margin-top:6px}.ic-create-comment-view #wysiwyg{border:1px solid #ccc;border-radius:3px;box-shadow:inset -1px 1px 5px #f5f5f5}.ic-create-comment-view #rte{background-color:#fff;box-shadow:inset 0 1px 3px #ccc;padding:8px}.ic-display-comment .ic-create-comment-view,.ic-replies .ic-create-comment-view,.ic-reply-container .ic-create-comment-view{border:none}.ic-display-comment .ic-create-comment,.ic-replies .ic-create-comment,.ic-reply-container .ic-create-comment{margin-bottom:0;margin-left:0;margin-right:0}.ic-create-comment-view #editor-notifications-container{display:none}",""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/display-comment/display-comment.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,'.ic-display-comment-view .ic-display-comment{margin:0 18px 0 17px}.ic-display-comment-view .ic-body{margin:5px 0 0}.ic-display-comment-view .ic-comment-container .ic-unresolved-message{border-top:1px solid #ccc;font-size:12px;padding:5px 18px 5px 16px}.ic-display-comment-view .ic-comment-container .ic-actions{margin-bottom:10px}.ic-content{word-wrap:break-word;overflow-x:hidden}.ic-content pre{overflow-x:auto}.ic-body>.ic-content>p{word-wrap:break-word;white-space:pre-wrap}#ic-menu-items{max-width:160px;min-width:100px}.ic-container .ic-action-resolve .ic-unresolved{color:#f5f5f5}.ic-container .ic-action-resolve .ic-resolved{color:#14892c}.ic-display-comment-view .resolved{background-color:#fff;position:relative}.ic-display-comment-view .resolved .ic-container{opacity:.2}.ic-page-comment,.ic-resolved-mask{padding-bottom:20px;text-align:center;width:100%}.ic-page-comment .ic-page-comment-content,.ic-page-comment .ic-resolved-mask-content,.ic-resolved-mask .ic-page-comment-content,.ic-resolved-mask .ic-resolved-mask-content{margin:32px auto 20px}.ic-page-comment .ic-page-comment-content .line,.ic-page-comment .ic-resolved-mask-content .line,.ic-resolved-mask .ic-page-comment-content .line,.ic-resolved-mask .ic-resolved-mask-content .line{display:block}.ic-page-comment .ic-page-comment-content .aui-iconfont-success,.ic-page-comment .ic-resolved-mask-content .aui-iconfont-success,.ic-resolved-mask .ic-page-comment-content .aui-iconfont-success,.ic-resolved-mask .ic-resolved-mask-content .aui-iconfont-success{color:#14892c;margin:0 auto 5px}.ic-page-comment .ic-page-comment-message-container,.ic-page-comment .resolved-message-container,.ic-resolved-mask .ic-page-comment-message-container,.ic-resolved-mask .resolved-message-container{margin:10px 18px 0 16px}.ic-page-comment .ic-page-comment-message-container .ic-page-comment-message-sideline,.ic-page-comment .ic-page-comment-message-container .resolved-message-sideline,.ic-page-comment .resolved-message-container .ic-page-comment-message-sideline,.ic-page-comment .resolved-message-container .resolved-message-sideline,.ic-resolved-mask .ic-page-comment-message-container .ic-page-comment-message-sideline,.ic-resolved-mask .ic-page-comment-message-container .resolved-message-sideline,.ic-resolved-mask .resolved-message-container .ic-page-comment-message-sideline,.ic-resolved-mask .resolved-message-container .resolved-message-sideline{text-align:center}.ic-page-comment .ic-page-comment-message-container .ic-page-comment-message-sideline .resolved-menu-name,.ic-page-comment .ic-page-comment-message-container .resolved-message-sideline .resolved-menu-name,.ic-page-comment .resolved-message-container .ic-page-comment-message-sideline .resolved-menu-name,.ic-page-comment .resolved-message-container .resolved-message-sideline .resolved-menu-name,.ic-resolved-mask .ic-page-comment-message-container .ic-page-comment-message-sideline .resolved-menu-name,.ic-resolved-mask .ic-page-comment-message-container .resolved-message-sideline .resolved-menu-name,.ic-resolved-mask .resolved-message-container .ic-page-comment-message-sideline .resolved-menu-name,.ic-resolved-mask .resolved-message-container .resolved-message-sideline .resolved-menu-name{font-weight:700}.ic-delete-comment-view{margin-bottom:50px;margin-top:50px;text-align:center}.ic-delete-comment-view .ic-delete-image{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAA2klEQVR4Xu2XQQrCMBBFeyN7Gj1FSHK5nsl6BLvQBBqQR2mcSQKC8+AvdJw3H+3GaTL+Ae/9LYRwjzG+jpJn+TPcG8ZZmc9S3BtGOcr3C7V5d2oHa3MVSXj95qeRRv18jShTonq+KOkd3qtCQe/wXhUKeof3jG7wq24N/WIobA39YihsDf1iKGwN/WIoTNk4O3m9cb/M1FBohQiFVohQaIUIhVaIUGiFCIW/UGiltCEr/WLSX5blQKxKdtEvJknmlCfl0mSHc+5Cv4q91JLy4KFa8s6+O9NraHgDIjRDQD3hAXgAAAAASUVORK5CYII=");display:block;height:36px;margin:0 auto 5px;width:36px}li.ic-action-like-reply:before,li.ic-action-like:before{display:none}.ic-actions a.ic-date-link{color:#707070;cursor:pointer;font-size:12px}.ic-actions a.ic-date-nolink{--aui-link-hover-decoration:none;color:#707070;cursor:text;font-size:12px}.ic-comment-reply-highlight{border-left:4px solid #3572b0;margin-left:-1px}',""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/display-reply/display-reply.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,".ic-replies{background-color:#f5f5f5;border-bottom:1px solid #ccc;border-left:1px solid #ccc}.ic-replies .ic-body{margin:5px 0 0}.ic-replies #ic-showmore-container{border-bottom:1px solid #ccc;height:29px}.ic-replies #ic-showmore-container .ic-decor-line{border-bottom:1px solid #ccc;height:9px}.ic-replies #ic-showmore-container .ic-collapse-decor-center{position:relative;text-align:center}.ic-replies #ic-showmore-container .ic-collapse-decor-center span{background-color:#f5f5f5;cursor:pointer;padding:0 5px;position:relative;top:-16px}.ic-replies:empty{border-bottom:none}.ic-display-reply,.ic-reply-container{padding:10px 18px 10px 17px}.ic-display-reply.focused,.ic-reply-container.focused{border-left:4px solid #3b73af}.ic-display-reply .ic-author,.ic-reply-container .ic-author{font-weight:400;line-height:16px}.ic-display-reply .ic-author .aui-avatar-inner,.ic-display-reply .ic-author .aui-avatar-small,.ic-reply-container .ic-author .aui-avatar-inner,.ic-reply-container .ic-author .aui-avatar-small{height:16px;width:16px}.ic-reply-container{background-color:#f5f5f5;border-bottom:1px solid #ccc;border-left:1px solid #ccc;padding:0 18px 0 17px}.ic-create-comment-view+.ic-reply-placeholder,.ic-reply-container:empty{display:none}.ic-reply-placeholder{padding-bottom:20px}.ic-reply-placeholder textarea.textarea.ic-textarea{height:30px;resize:none}",""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/likes/likes.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,".ic-likes{display:inline-block}.ic-like-summary{color:#707070}.ic-small-like-icon{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAgVBMVEX///9wcHBwcHBwcHCZmZlwcHCAgIBwcHB8fHyDg4N8fHyFhYV6enp0dHSDg4ODg4ONjY18fHz///9wcHDY2Nh4eHirq6t8fHzFxcXr6+uOjo6goKC9vb25ubm0tLR6enqysrJ0dHTi4uKRkZF4eHhwcHCIiIiAgICZmZl0dHR8fHxFDOKcAAAAI3RSTlMAESIzM0RVVWaZqrvMzMzd3d3u7u7u7u7u7u7u7u7u7u7u7onc57sAAABpSURBVBhXnctHCoAwFEXRWGLX6Lf3EmPb/wKFfBSdiXf2DjxC/hfkxmvrVem9IEwSW1PuqbgZLJ4f4zJjkQ4AEwCjEsZ6K0DGNAk7zLghwkt+QZki9E3WSugcBEuIY14554KSZ5Sq5FMnOowHUQGHjSIAAAAASUVORK5CYII=) no-repeat;display:inline-block;height:14px;margin:0 3px -1px 0;width:16px}.ic-likes-count{cursor:pointer;font-size:12px}",""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/navigation/navigation.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,"#ic-nav-container{color:#707070;display:inline-block}#ic-nav-container #ic-nav-previous{margin-left:3px}#ic-nav-container #ic-nav-next span,#ic-nav-container #ic-nav-previous span{margin-top:-2px}#ic-nav-container .ic-nav-x-out-of-y{font-size:12px;padding-left:10px;vertical-align:text-top}",""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/resolved-comment/resolved-comment.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,"#ic-resolved-comment-dialog{padding:0 20px}#ic-resolved-comment-dialog .ic-display-comment-view:last-child{border-bottom:none}#ic-resolved-comment-dialog .ic-display-comment-view{border-bottom:1px solid #ccc;padding:20px 0}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment{margin:0;padding-left:20px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-author{padding-top:0}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-author .url{max-width:460px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-author-avatar{margin:0 8px 0 0}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-body{margin:20px 0 12px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-body .ic-content blockquote{border-left:1px solid #ccc;margin-left:0}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-body .ic-content blockquote .ic-resolved-marker{background-color:#f6c3424d;color:#707070;line-height:1.6;padding:2px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-body .ic-content blockquote .ic-body-comment{margin-top:18px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-actions{font-size:12px;margin-top:6px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-actions .ic-action-show-reply{color:#3b73af}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-actions ul li:not(.hidden):nth-child(3) .ic-date-link span{width:345px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-display-comment .ic-actions ul li:nth-child(2) .ic-date-link span{width:400px}#ic-resolved-comment-dialog .ic-display-comment-view .focused{border-left:5px solid #3b73af}#ic-resolved-comment-dialog .ic-display-comment-view .aui-button{height:auto;line-height:normal;outline:none}#ic-resolved-comment-dialog .ic-display-comment-view .ic-resolved-message{color:#707070;font-size:12px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-resolved-message .aui-iconfont-success{color:#14892c;margin-left:4px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-resolved-message .ic-date-link span{display:inline-block;height:20px;overflow:hidden;text-overflow:ellipsis;vertical-align:middle;white-space:nowrap;width:360px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-replies{border:none;margin-top:15px;padding:10px 0}#ic-resolved-comment-dialog .ic-display-comment-view .ic-replies .ic-display-reply{padding-left:20px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-replies .ic-display-reply .ic-date-link{color:#707070;cursor:pointer;font-size:12px}#ic-resolved-comment-dialog .ic-display-comment-view .ic-replies .ic-reply-content{max-width:none}#ic-resolved-comment-dialog .ic-display-comment-view .ic-replies .ic-author .url{max-width:440px}#ic-resolved-comment-dialog .aui-message{margin-bottom:10px}#ic-resolved-comment-dialog #ic-resolved-comment-dialog-error .aui-message{margin:20px 0 0}#inline-dialog-ic-resolved-dialog-discovery{border:2px solid #f79232;border-radius:5px}#inline-dialog-ic-resolved-dialog-discovery .contents{border:none;padding:16px}",""]),t.a=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/sidebar/sidebar.scss":function(e,t,i){"use strict";var n=i("./node_modules/css-loader/dist/runtime/api.js"),s=i.n(n)()((function(e){return e[1]}));s.push([e.i,"#rte-savebar{background-color:#fff}.ic-sidebar{clear:both;position:absolute;right:0;top:0;width:280px}.ic-sidebar>div{max-width:280px;width:280px}.ic-error>.aui-message{margin:10px}.ic-slide-in{animation:ic-slide-in .5s 1}@keyframes ic-slide-in{0%{right:-280px}to{right:0}}.ic-slide-out{animation:ic-slide-out .51s 1}@keyframes ic-slide-out{0%{right:0}to{right:-280px}}.ic-highlight-pulse{animation:ic-highlight-pulse .5s 1}@keyframes ic-highlight-pulse{0%{background-color:#f6c342}50%{background-color:#f6c3424d}to{background-color:#f6c342}}.ic-fade-out-animation{animation:ic-fade-out-animation .5s 1}.ic-fade-in-animation{animation:ic-fade-in-animation .8s 1}",""]),t.a=s},"./src/main/frontend/loader/loader.ts":function(e,t,i){"use strict";i.r(t);var n=i("./node_modules/@atlassian/wrm-react-i18n/wrm-react-i18n.js"),s=i("confluence.web.resources:jquery/require('backbone')"),o=i.n(s),a=i("com.atlassian.confluence.plugins.confluence-inline-comments:util-resource/require('confluence/ic/util/text-highlighter')"),r=i.n(a),c=i("confluence.web.components:confluence/require('confluence/root')"),l=i.n(c),d=i("confluence.web.resources:jquery/require('jquery')"),m=i.n(d),h=i("./src/main/frontend/utils/utils.ts"),u=i("confluence.web.resources:underscore/require('underscore')"),p=i.n(u);var g={init:function(e){this.likesCache=p.a.clone(e)||{}},getLikes:function(e){if(this.likesCache&&this.likesCache[e]){return p.a.map(this.likesCache[e].likes,(function(e){return{username:e.user.name}}))}return null},add:function(e,t){this.likesCache[e]||(this.likesCache[e]={likes:[]}),this.likesCache[e].likes.push({user:{name:t}})},remove:function(e,t){if(this.likesCache[e]&&this.likesCache[e].likes){const i=p.a.reject(this.likesCache[e].likes,(function(e){return e.user.name===t}));this.likesCache[e].likes=i}},isLikable:function(){return void 0!==this.likesCache}},v=i("confluence.web.resources:ajs/require('ajs')"),f=i.n(v),b=i("confluence.web.resources:event/require('confluence/api/event')"),y=i.n(b),w=i("com.atlassian.confluence.plugins.confluence-frontend:react/require('react')"),x=i.n(w),k=i("com.atlassian.confluence.plugins.confluence-frontend:react-dom-server/require('react-dom/server')"),E=i.n(k),C=i("confluence.web.resources:constants/require('confluence/api/constants')"),T=i("./src/main/frontend/view/AUI/index.ts"),O=i("./src/main/frontend/view/AUI/Avatar.tsx");const j=e=>{let{disabled:t,showIndex:i,index:s,size:o,isViewMode:a=!0,isMacOS:r=!1}=e;const c=a?"aui-button-text view-mode":"aui-button-text edit-mode",l=a?"Next comment (N)":r?"Next comment (\u2318+\u21e7+O)":"Previous comment (Ctrl+Shift+L)",d=a?"Previous comment (P)":r?"Previous comment (\u2318+\u21e7+L)":"Previous comment (Ctrl+Shift+L)";return x.a.createElement(x.a.Fragment,null,x.a.createElement(T.a,{type:"text",id:"ic-nav-next",extraClasses:c,iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-down",text:"",isDisabled:t,extraAttributes:{tabIndex:t?"":0,title:l,"aria-label":l}}),x.a.createElement(T.a,{type:"text",id:"ic-nav-previous",extraClasses:c,iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-up",text:"",isDisabled:t,extraAttributes:{tabIndex:t?"":0,title:d,"aria-label":d}}),i&&x.a.createElement("span",{className:"ic-nav-x-out-of-y"},n.format("{0} of {1}",s,o)))};var I=i("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),N=i.n(I),_=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/common/common.scss"),A={insert:"head",singleton:!1};N()(_.a,A),_.a.locals;const D=f.a.Confluence.Templates.User.usernameLink,R=e=>{let{authorUserName:t,authorAvatarUrl:i,size:n}=e;return""===t?x.a.createElement(O.a,{size:n,avatarImageUrl:i,extraClasses:"ic-author-avatar",accessibilityText:" "}):x.a.createElement("a",{"data-username":t,href:`${C.CONTEXT_PATH}/display/~${t}`,title:"","data-user-hover-bound":"true",tabIndex:-1,role:"presentation","aria-hidden":"true"},x.a.createElement(O.a,{size:n,avatarImageUrl:i,extraClasses:"ic-author-avatar",accessibilityText:" "}))},V=e=>{let{showMenu:t,hasDeletePermission:i,hasEditPermission:s,hasResolvePermission:o,hasReplyPermission:a,createComment:r,darkFeatures:c,isViewMode:l,isMacOS:d}=e;const m=l?"ic-action-hide view-mode":"ic-action-hide edit-mode",h=l?"Close sidebar (])":d?"Close sidebar (\u2318+\u21e7+Z)":"Close sidebar (Ctrl+Shift+Z)";return x.a.createElement(x.a.Fragment,null,x.a.createElement("div",{className:"ic-sidebar-heading"},x.a.createElement("div",{id:"ic-nav-container"},r&&x.a.createElement(j,{disabled:!0,showIndex:!1,isViewMode:l,isMacOS:d})),x.a.createElement("div",{className:"ic-right-toolbar"},t&&x.a.createElement(P,{hasDeletePermission:i,hasEditPermission:s,hasResolvePermission:o,hasReplyPermission:a,darkFeatures:c}),x.a.createElement(T.a,{type:"text",extraClasses:m,iconClass:"aui-icon-small aui-iconfont-close-dialog",text:"",extraAttributes:{title:h,"aria-label":h}}))),x.a.createElement("div",{className:"ic-error"}))},S=e=>{let{authorDisplayName:t,authorUserName:i,authorAvatarUrl:n}=e;return x.a.createElement("div",{className:"ic-author"},x.a.createElement(R,{authorUserName:i,authorAvatarUrl:n,size:"small"}),x.a.createElement("div",{dangerouslySetInnerHTML:{__html:D({canView:""!==i,username:i,fullName:t}).toString()}}))},L=e=>{let{time:t,commentUrl:i,displayLink:n}=e;return x.a.createElement(x.a.Fragment,null,n?x.a.createElement("a",{className:"ic-date-link",title:t,href:`${C.CONTEXT_PATH||""}${i||""}`},x.a.createElement("span",null,t)):x.a.createElement("a",{className:"ic-date-nolink"},x.a.createElement("span",null,t)))},M=e=>{let{id:t,body:i,authorDisplayName:s,authorUserName:o,authorAvatarUrl:a,currentAuthorDisplayName:r,currentAuthorUserName:c,currentAuthorAvatarUrl:l,hasDeletePermission:d,hasResolvePermission:m,hasEditPermission:u,hasReplyPermission:p,showMenu:g,resolveProperties:v,lastModificationDate:f,commentDateUrl:b,darkFeatures:y}=e;return x.a.createElement(x.a.Fragment,null,x.a.createElement("div",{className:"ic-comment-container"},x.a.createElement(V,{hasDeletePermission:d,hasResolvePermission:m,hasEditPermission:u,hasReplyPermission:p,showMenu:!(!g||v.resolved),darkFeatures:y,createComment:!Object(h.A)(),isViewMode:!Object(h.A)(),isMacOS:Object(h.C)()}),v.resolved?x.a.createElement(q,{displayShowMeLink:!Object(h.A)()}):x.a.createElement(z,{id:t,body:i,authorDisplayName:s,authorUserName:o,authorAvatarUrl:a,hasResolvePermission:m,resolveProperties:v,hasDeletePermission:d,lastModificationDate:f,commentDateUrl:b,darkFeatures:y})),!v.resolved&&x.a.createElement(x.a.Fragment,null,x.a.createElement("div",{className:"ic-list"}),x.a.createElement("div",{className:"ic-reply-container"},y.INLINE_COMMENTS&&p&&x.a.createElement("div",{className:"ic-reply-placeholder"},x.a.createElement(S,{authorUserName:c,authorAvatarUrl:l,authorDisplayName:r}),x.a.createElement("div",{className:"ic-body"},x.a.createElement("form",{className:"aui"},x.a.createElement("textarea",{className:"textarea ic-textarea",name:"body",placeholder:"Reply"})))))))},U=()=>x.a.createElement("div",{className:"ic-comment-container ic-deleted"},x.a.createElement(V,{createComment:!1,showMenu:!1,isViewMode:!Object(h.A)(),isMacOS:Object(h.C)()}),x.a.createElement("div",{className:"ic-delete-comment-view"},x.a.createElement("h2",null,x.a.createElement("span",{className:"aui-icon ic-delete-image line"},"::before"),"Deleted"))),P=e=>{let{hasDeletePermission:t,hasResolvePermission:i,hasEditPermission:s,hasReplyPermission:o,darkFeatures:a}=e;const r=x.a.createElement("ul",{className:"aui-list-truncate"},i&&(null==a?void 0:a.RESOLVED_INLINE_COMMENTS)&&x.a.createElement("li",{className:"ic-action-resolve"},x.a.createElement("a",{href:"#"},"Resolve")),o&&x.a.createElement("li",{className:"ic-action-reply"},x.a.createElement("a",{href:"#"},"Reply")),s&&x.a.createElement("li",{className:"ic-action-edit"},x.a.createElement("a",{href:"#"},"Edit")),t&&x.a.createElement("li",{className:"ic-action-delete"},x.a.createElement("a",{href:"#"},"Delete")));return x.a.createElement(x.a.Fragment,null,(null==a?void 0:a.INLINE_COMMENTS)&&(t||o||i&&(null==a?void 0:a.RESOLVED_INLINE_COMMENTS))&&x.a.createElement(x.a.Fragment,null,x.a.createElement(T.a,{type:"subtle",extraClasses:"aui-button-compact aui-dropdown2-trigger-arrowless aui-style-default ic-action-menu",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-more",text:"",dropdown2Target:"ic-menu-items",extraAttributes:{"aria-label":"More options"}}),x.a.createElement(T.c,{id:"ic-menu-items",extraClasses:"aui-style-default"},r)))},$=e=>{let{commentId:t}=e;return x.a.createElement("div",{className:"ic-comment-container"},x.a.createElement(V,{createComment:!1,showMenu:!1,isViewMode:!Object(h.A)(),isMacOS:Object(h.C)()}),x.a.createElement("div",{className:"ic-page-comment-view"},x.a.createElement("div",{className:"ic-page-comment"},x.a.createElement("div",{className:"ic-page-comment-content"},x.a.createElement("h2",{className:"ic-resolved-icon"},x.a.createElement(T.d,{useIconFont:!0,size:"large",icon:"success",extraClasses:"line"}),"Saved")),x.a.createElement("div",{className:"ic-page-comment-message-container"},x.a.createElement("div",{className:"ic-page-comment-message-sideline"},x.a.createElement("p",null,"Your comment has been saved as a page comment."),x.a.createElement("button",{id:"show-page-comment",className:"aui-button aui-button-link","data-comment-id":t},"Show me"))))))},F=e=>{let{hasResolvePermission:t,hasDeletePermission:i,lastModificationDate:s,commentDateUrl:o,darkFeatures:a}=e;return x.a.createElement(x.a.Fragment,null,(null==a?void 0:a.INLINE_COMMENTS)&&x.a.createElement("div",{className:"ic-actions"},x.a.createElement("ul",{className:"aui-list-truncate"},t&&(null==a?void 0:a.RESOLVED_INLINE_COMMENTS)&&x.a.createElement("li",null,x.a.createElement(T.a,{text:"Resolve",type:"link",extraClasses:"ic-action-resolve"})),i&&Object(h.A)()&&x.a.createElement("li",null,x.a.createElement(T.a,{text:"Delete",type:"link",extraClasses:"ic-action-delete"})),x.a.createElement("li",{className:"ic-action-like"}),x.a.createElement("li",{className:"ic-date"},x.a.createElement(L,{time:s,commentUrl:o,displayLink:!Object(h.A)()})))))},H=e=>{let{hasResolvePermission:t,isDangling:i,resolveProperties:s,commentDateUrl:o,darkFeatures:a}=e;return x.a.createElement(x.a.Fragment,null,(null==a?void 0:a.INLINE_COMMENTS)&&x.a.createElement("div",{className:"ic-actions"},x.a.createElement("ul",{className:"aui-list-truncate"},t&&!i&&x.a.createElement("li",null,x.a.createElement(T.a,{type:"link",extraClasses:"ic-action-unresolve",text:"Reopen"})),x.a.createElement("li",{className:"hidden"},x.a.createElement(T.a,{type:"link",extraClasses:"ic-action-show-reply"})),(null==s?void 0:s.resolvedTime)>0&&x.a.createElement("li",{className:"ic-resolved-message"},x.a.createElement(T.d,{useIconFont:!0,size:"small",icon:"success"})," ",x.a.createElement("span",null,x.a.createElement(L,{time:i&&null!=s&&s.resolvedByDangling?n.format("Resolved because the text was deleted by {0} {1}",null==s?void 0:s.resolvedUser,null==s?void 0:s.resolvedFriendlyDate):n.format("Resolved by {0} {1}",null==s?void 0:s.resolvedUser,null==s?void 0:s.resolvedFriendlyDate),commentUrl:o||"",displayLink:!Object(h.A)()}))))))},z=e=>{let{id:t,body:i,authorDisplayName:s,authorUserName:o,authorAvatarUrl:a,resolveProperties:r,lastModificationDate:c,commentDateUrl:l,darkFeatures:d,hasResolvePermission:m,hasDeletePermission:h,isDangling:u,originalSelection:p}=e;const g=()=>{const e=`${null!=r&&r.resolved?`<blockquote>\n                    <span class="ic-resolved-marker">${p||""}</span>\n                </blockquote>`:""}${i}`;return x.a.createElement("div",{className:"ic-content",dangerouslySetInnerHTML:{__html:e}})};return x.a.createElement(x.a.Fragment,null,x.a.createElement("div",{"data-comment-id":t,className:"ic-container ic-display-comment"},x.a.createElement(S,{authorUserName:o,authorAvatarUrl:a,authorDisplayName:s}),x.a.createElement("div",{className:"ic-body wiki-content"},x.a.createElement(g,null)),null!=r&&r.resolved?x.a.createElement(H,{hasResolvePermission:m,isDangling:u,resolveProperties:r,commentDateUrl:l,darkFeatures:d}):x.a.createElement(F,{hasResolvePermission:m,hasDeletePermission:h,lastModificationDate:c,commentDateUrl:l,darkFeatures:d})),!(null!=r&&r.resolved)&&(null==r?void 0:r.resolvedTime)>0&&(null==r?void 0:r.resolvedUser)&&x.a.createElement("div",{className:"ic-unresolved-message"},n.format("Reopened by {0} {1}",null==r?void 0:r.resolvedUser,null==r?void 0:r.resolvedFriendlyDate)))},q=e=>{let{displayShowMeLink:t}=e;return x.a.createElement("div",{className:"ic-resolved-mask"},x.a.createElement("div",{className:"ic-resolved-mask-content"},x.a.createElement("h2",{className:"ic-resolved-icon"},x.a.createElement(T.d,{useIconFont:!0,size:"large",icon:"success",extraClasses:"line"}),"Resolved")),x.a.createElement("div",{className:"resolved-message-container"},x.a.createElement("div",{className:"resolved-message-sideline"},t?x.a.createElement("p",null,"You can see resolved comments at any time."):x.a.createElement(x.a.Fragment,null,x.a.createElement("p",null,x.a.createElement("span",null,"To reopen resolved comments, close the editor and select")," ",x.a.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-more"})," ",x.a.createElement("span",{className:"aui-icon aui-icon-small aui-iconfont-arrow-right"})," ",x.a.createElement("span",{className:"resolved-menu-name"},"Resolved comments"))),t&&x.a.createElement(T.a,{text:"Show me",type:"link",id:"show-resolved-comments"}))))};var B=i("confluence.web.resources:meta/require('confluence/meta')"),X=i.n(B);var Y=o.a.Model.extend({initialize:function(e){if(!e)throw new Error("Attributes is required");if(!e.username)throw new Error("username is a required attribute")}});var Q=o.a.Collection.extend({model:Y,url:function(){return`${C.CONTEXT_PATH}/rest/likes/1.0/content/${this.contentId}/likes`},initialize:function(e,t){if(p.a.bindAll(this,"_handleSaveSuccess","_handleDestroySuccess","_handleError"),void 0===(t=t||{}).contentId)throw new Error("content ID is required.");this.contentId=t.contentId,g.getLikes(t.contentId)&&this.reset(g.getLikes(t.contentId)),this.listenTo(o.a,"ic:likes-received",this.updateLikes),this.bind("add",e=>{e.save(null,{success:this._handleSaveSuccess,error:this._handleError})}),this.bind("remove",e=>{e.id="",e.destroy({success:this._handleDestroySuccess,error:this._handleError})}),this.currentUserName=X.a.get("remote-user")},updateLikes:function(){this.reset(g.getLikes(this.contentId))},addUser:function(e){return this.add({username:e})},removeUser:function(e){return this.remove(this.getUserByName(e))},isLikedByUser:function(e){return!!this.getUserByName(e)},getUserByName:function(e){return this.findWhere({username:e})},toggleLike:function(){this.isLikedByUser(this.currentUserName)?this.removeUser(this.currentUserName):this.addUser(this.currentUserName)},_handleSaveSuccess:function(){g.add(this.contentId,this.currentUserName)},_handleDestroySuccess:function(){g.remove(this.contentId,this.currentUserName)},_handleError:function(e,t){this.updateLikes(),405===t.status&&t.responseText?o.a.trigger("ic:error","This site is read-only. You can\u0027t make changes right now."):o.a.trigger("ic:error","Likes cannot be updated.")}});const J=e=>{let{showLikeButton:t,isLikedByUser:i,likesCount:s,contentId:o}=e;return x.a.createElement(x.a.Fragment,null,t&&x.a.createElement(T.a,{text:i?"Unlike":"Like",type:"link",extraClasses:"ic-like-button"}),s>0&&x.a.createElement("span",{className:"ic-like-summary"},x.a.createElement("span",{className:"ic-small-like-icon"}),x.a.createElement("a",{className:"ic-likes-count","data-content-id":o},x.a.createElement("span",{className:"ic-like-summary"},s))))};var K=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/likes/likes.scss"),G={insert:"head",singleton:!1};N()(K.a,G),K.a.locals;var W=o.a.View.extend({className:"ic-likes",events:{"click .ic-like-button":"toggleLike","click .ic-likes-count":function(e){f.a.Confluence.Likes.showLikeUsers&&f.a.Confluence.Likes.showLikeUsers.apply(e.currentTarget,[e])}},initialize:function(e){this.collection=new Q(null,{contentId:e.contentId}),this.listenTo(this.collection,"add remove reset",this.render),this.currentUserName=X.a.get("remote-user")||"",void 0===e.showLikeButton?this.showLikeButton=!0:this.showLikeButton=e.showLikeButton},render:function(){if(this.$el.empty(),g.isLikable()){const e=""!==this.currentUserName&&!1!==X.a.get("remote-user-has-licensed-access"),t=this.collection.length,i=this.collection.isLikedByUser(this.currentUserName);this.showLikeButton="READ_ONLY"!==X.a.get("render-mode");const n={showLikeButton:this.showLikeButton&&e,isLikedByUser:i,likesCount:t,contentId:this.collection.contentId};this.$el.html(E.a.renderToStaticMarkup(x.a.createElement(J,n)))}return this},toggleLike:function(){this.collection.toggleLike()}}),Z=i("com.atlassian.confluence.plugins.confluence-editor-plugin:core/require('tinymce')"),ee=i.n(Z);i(2),i(3);function te(){f.a.Confluence.EditorLoader.resourcesLoaded()||this.$form.find(".loading-container").spin("small")}function ie(){X.a.set("content-type","comment"),X.a.set("use-inline-tasks","false"),X.a.set("min-editor-height",80)}function ne(e){e.$form.find(".loading-container").hide(),e.$form.find("#rte-button-publish").text("Save").removeAttr("title"),e.$form.find("#toolbar-hints-draft-status").hide(),this.hideCancelButton&&e.$form.find("#rte-button-cancel").hide(),e.editor.on("PostProcess",function(e,t){const i=function(){ee.a.DOM.setStyle(ee.a.DOM.get(t.id+"_ifr"),"height","80px"),t.execCommand("mceAutoResize",{forceExec:!0}),t.off(e,i)};return i}("PostProcess",e.editor)),f.a.Confluence.Editor&&!f.a.Confluence.Editor.getContentType&&f.a.Confluence.QuickEdit.QuickEditPage.disable(),f.a.Confluence.Editor.removeAllCancelHandlers(),f.a.Confluence.Editor.removeAllSaveHandlers()}function se(){return Object(h.n)()?f.a.Confluence.QuickEdit.deactivateEditor():m.a.Deferred().resolve()}var oe=i("./src/main/frontend/model/comment.ts"),ae=i("./src/main/frontend/model/reply.ts");const re=e=>{let{authorUserName:t,authorAvatarUrl:i,authorDisplayName:n,type:s,darkFeatures:o,text:a,parentClassName:r="ic-comment-container"}=e;return x.a.createElement("div",{className:r},("topLevel"===s||"pageComment"==s)&&x.a.createElement(V,{showMenu:!1,createComment:!0,darkFeatures:o,isViewMode:!0}),x.a.createElement(ce,{authorUserName:t,authorAvatarUrl:i,authorDisplayName:n,type:s,text:a||"",darkFeatures:o}))},ce=e=>{let{authorUserName:t,authorAvatarUrl:i,authorDisplayName:s,type:o,text:a,darkFeatures:r}=e;return x.a.createElement("div",{className:"ic-container ic-create-comment"},x.a.createElement(S,{authorUserName:t||"",authorAvatarUrl:i||"",authorDisplayName:s||""}),x.a.createElement("div",{className:"ic-body"},x.a.createElement("form",{className:"aui",action:""},null!=r&&r.RICH_TEXT_EDITOR?x.a.createElement("div",{className:"loading-container"}):x.a.createElement(x.a.Fragment,null,(()=>{const e="reply"===o?null===n.I18n||void 0===n.I18n?void 0:"Reply":null===n.I18n||void 0===n.I18n?void 0:"write a comment...";return x.a.createElement("textarea",{className:"textarea ic-textarea",name:"body",placeholder:e,defaultValue:a})})(),x.a.createElement("div",{className:"ic-actions"},x.a.createElement("ul",null,x.a.createElement("li",null,x.a.createElement(T.a,{text:"Save",type:"link",extraClasses:"ic-action-save",isDisabled:!0})),"topLevel"===o&&x.a.createElement("li",null,x.a.createElement(T.a,{text:"Cancel",type:"link",extraClasses:"ic-action-discard"}))))))))};var le=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/create-comment/create-comment.scss"),de={insert:"head",singleton:!1};N()(le.a,de),le.a.locals;var me=o.a.View.extend({tagName:"div",className:"ic-create-comment-view",events:{"click .ic-action-save":"saveComment","click .ic-action-discard":"discardComment","keyup .ic-textarea":"onInput","focus .ic-textarea":"onFocus","click #show-page-comment":"showPageComment"},template:e=>x.a.createElement(re,e),initialize:function(e){this.selection=e.selection,this.type=e.type,this.warningData=e.warningData,this.onFinished=e.onFinished||function(){},this.commentText=e.commentText||"",this.stopFocus=e.stopFocus,this.serializedHighlights=e.serializedHighlights,"edit"!==e.type&&"reply"!==e.type||(this.template=e=>x.a.createElement(ce,e),o.a.trigger("ic:discard-edit"),this.listenTo(o.a,"ic:discard-edit",this.discardComment))},finish:function(){this.onFinished(),y.a.trigger("ic-jim-async-supported")},render:function(){const e=this._getAuthorObject(),t={type:this.type,text:this.commentText,showMenu:!1},i=p.a.extend({},e,t,{darkFeatures:Object(h.m)()});return this.$el.html(E.a.renderToStaticMarkup(this.template(i))),Object(h.m)().RICH_TEXT_EDITOR?this.renderEditor():this.stopFocus||setTimeout(p.a.bind(this.focusEditor,this),1),Object(h.a)(this),this},onInput:function(e){const t=""!==this.$(e.target).val().trim();this._saveDisable(!t)},onFocus:function(){if("edit"===this.type){const e=this.$(".textarea");Object(h.E)(e[0]),this._saveDisable(""===e.text())}},saveComment:function(e){e.preventDefault(),this._isValid()&&(this._disableForm(),"reply"===this.type?this._addReply():"edit"===this.type?this._saveEdit():this._addComment())},_setAriaLabelToEditor:function(){Object(h.o)().attr("aria-label",this._getAriaLabel(this.type))},_getAriaLabel:function(e){switch(e){case"topLevel":return "Add an inline comment";case"reply":return "Reply to inline comment";case"edit":return "Edit inline comment";default:return "inline.default.edit.ariaLabel"}},_getAuthorObject:function(){let e,t,i;return"edit"===this.type?(e=this.model.get("authorUserName"),t=this.model.get("authorAvatarUrl"),i=this.model.get("authorDisplayName")):(e=X.a.get("remote-user"),t=Object(h.i)(),i=Object(h.j)()),{authorUserName:e,authorAvatarUrl:t,authorDisplayName:i}},_saveEdit:function(){const e=this._getContent(),t={wait:!0,beforeSend:p.a.bind(this.beforeSendAjax,this),success:p.a.bind(this._onSaveSuccess,this),error:p.a.bind(this._showEditError,this)};this.model.save({body:e},t)},_showEditError:function(e,t){if(this.showCaptchaError(t))return;let i;switch(t.status){case 401:i="You don\u0027t have permission to edit this comment.";break;case 405:if(t.responseText){if("READ_ONLY"===JSON.parse(t.responseText).reason){i="This site is read-only. You can\u0027t make changes right now.";break}}break;case 400:if(t.responseText&&t.responseText.indexOf("Unsupported character found in content: ")>=0){const e=t.responseText.split("Unsupported character found in content: ")[1];i=n.format("We can\u0027\u0027t save your inline comment because the {0} character isn\u0027\u0027t supported by your database.\u003cbr\u003e\u003cbr\u003eRemove this character or use a Confluence symbol or emoticon instead. \u003ca href = \u0022https://confluence.atlassian.com/x/BYfsNg\u0022 target=\u0022_blank\u0022\u003eLearn more\u003c/a\u003e",e)}break;default:i="We can\u0027t save your edit. The comment might have been deleted."}this._triggerError(i,{})},_triggerError:function(e,t){o.a.trigger("ic:error",e,t),this._disableForm(!1)},_addReply:function(){new ae.a({body:this._getContent(),commentId:this.model.get("id"),hasDeletePermission:!!X.a.get("remote-user")||this.model.get("hasDeletePermission")}).save(null,{beforeSend:p.a.bind(this.beforeSendAjax,this),success:p.a.bind(this._onSaveSuccess,this),error:p.a.bind((e,t)=>{if(!this.showCaptchaError(t))if(405===t.status&&t.responseText){"READ_ONLY"===JSON.parse(t.responseText).reason&&o.a.trigger("ic:error","This site is read-only. You can\u0027t make changes right now.")}else if(400===t.status&&t.responseText){const e=t.responseText.split("Unsupported character found in content: ")[1];this._triggerError(n.format("We can\u0027\u0027t save your inline comment because the {0} character isn\u0027\u0027t supported by your database.\u003cbr\u003e\u003cbr\u003eRemove this character or use a Confluence symbol or emoticon instead. \u003ca href = \u0022https://confluence.atlassian.com/x/BYfsNg\u0022 target=\u0022_blank\u0022\u003eLearn more\u003c/a\u003e",e),{})}else this._triggerError("Could not save the reply",{})},this)})},_addComment:function(){const e=new oe.a({originalSelection:this.selection.searchText.selectedText.replace(/\n/g,""),body:this._getContent(),matchIndex:this.selection.searchText.index,numMatches:this.selection.searchText.numMatches,serializedHighlights:this.serializedHighlights}),t={callback:this.bindPageReloadLink};e.save(null,{beforeSend:p.a.bind(this.beforeSendAjax,this),success:p.a.bind(this._onSaveSuccess,this),error:p.a.bind((e,i)=>{if(!this.showCaptchaError(i))switch(i.status){case 405:this._triggerError("This site is read-only. You can\u0027t make changes right now.",{});break;case 409:this._triggerError(n.format("Page content is out of date, please {0}refresh{1} and try again.",'<a href="#" class="ic-reload-page">',"</a>"),t);break;case 412:y.a.trigger("analytics",{name:"confluence.comment.inline.cannot.create"}),this._triggerError("We can\u0027t add your inline comment; the section you highlighted may contain a macro or user mention. Try highlighting plain text.",{});break;case 400:if(i.responseText&&i.responseText.indexOf("Unsupported character found in content: ")>=0){const e=i.responseText.split("Unsupported character found in content: ")[1];this._triggerError(n.format("We can\u0027\u0027t save your inline comment because the {0} character isn\u0027\u0027t supported by your database.\u003cbr\u003e\u003cbr\u003eRemove this character or use a Confluence symbol or emoticon instead. \u003ca href = \u0022https://confluence.atlassian.com/x/BYfsNg\u0022 target=\u0022_blank\u0022\u003eLearn more\u003c/a\u003e",e),{})}break;default:this._triggerError("Could not save the comment",{})}},this)})},_isValid:function(){return""!==m.a.trim(this._getContent())||(o.a.trigger("ic:error","You cannot save an empty comment."),!1)},_onSaveSuccess:function(e){switch(this.type){case"topLevel":e.set("hasDeletePermission",!0),o.a.trigger("ic:persist",e),o.a.trigger("ic:view",e,void 0,{ignoreConfirmDialog:!0});break;case"reply":this.model.replies.push(e),o.a.trigger("ic:reply:persist",e),this.finish();break;case"edit":o.a.trigger("ic:edit"),this.finish()}},_setEditorIsNotDirty:function(){const e=Object(h.n)();null!==e&&(e.isNotDirty=!0)},_disableForm:function(e){void 0===e&&(e=!0),this._saveDisable(e),Object(h.m)().RICH_TEXT_EDITOR||this.$(".ic-action-discard,.ic-textarea").prop("disabled",e).attr("aria-disabled",e)},_saveDisable:function(e){var t;Object(h.m)().RICH_TEXT_EDITOR?((t=e)?m()(".ic-sidebar #rte-spinner").spin():m()(".ic-sidebar #rte-spinner").spinStop(),m()("#rte-button-publish").prop("disabled",t),m()("#rte-button-cancel")[0].disabled=e):this.$(".ic-action-save").prop("disabled",e).attr("aria-disabled",e)},renderEditor:function(){const e=this.$(".ic-body"),t=this.commentText,i=f.a.Confluence.QuickEdit.QuickComment;return function(e){const{container:t,form:i,saveHandler:n,cancelHandler:s,fetchContent:o,postDeactivate:a}=e;return f.a.Confluence.QuickEdit.activateEditor({preActivate:te,preInitialise:ie,postInitialise:m.a.proxy(ne,e),toolbar:!1,$container:t,$form:i,saveHandler:n,cancelHandler:s,fetchContent:o(),closeAnyExistingEditor:!0,postDeactivate:a,plugins:Object(h.v)(),excludePlugins:Object(h.w)()})}({container:e,form:e.find("form.aui"),saveHandler:"pageComment"===this.type?i.createSaveHandler(p.a.bind(this._successCreatePageComment,this),i.saveCommentErrorHandler):p.a.bind(this.saveComment,this),cancelHandler:p.a.bind(this.discardComment,this),fetchContent:function(){const e=new m.a.Deferred;return e.resolve({editorContent:t}),e},postDeactivate:p.a.bind(()=>{o.a.trigger("ic:clearError"),this.finish()},this),hideCancelButton:"topLevel"===this.type}).done(p.a.bind(this.renderEditorCompleted,this)).fail(p.a.bind(this.renderEditorFail,this))},showPageComment:function(e){const t=m()(e.target).data("comment-id"),i=m()("#comment-"+t);i.addClass("focused"),i.scrollToElement()},_successCreatePageComment:function(e){f.a.Confluence.CommentDisplayManager.addComment(Object(h.l)(),e,!1,!1,!0),y.a.trigger("page.commentAddedOrUpdated",{commentId:e.id}),this._setEditorIsNotDirty(),Object(h.m)().RICH_TEXT_EDITOR&&(this.keepSidebar=!0,se()),this.$el.html(E.a.renderToStaticMarkup(x.a.createElement($,{commentId:e.id}))),Object(h.a)(this)},renderEditorCompleted:function(){if(o.a.trigger("ic:clearError"),this._setAriaLabelToEditor(),"topLevel"===this.type||"pageComment"===this.type)if(this.$("#rte-button-cancel").hide(),this.warningData){switch(this.warningData.type){case"mention":o.a.trigger("ic:error","We can\u0027t add an inline comment here because the selected text includes a mention.  We\u0027ll add it as a page comment instead.");break;case"internalLink":o.a.trigger("ic:error","We can\u0027t add an inline comment because the selected text includes a relative link. We\u0027ll add it as a page comment instead.");break;case"dateLozenge":o.a.trigger("ic:error","We can\u0027t add an inline comment here because the selected text includes a date lozenge.");break;case"unsupportedMacro":{let e;f.a.MacroBrowser&&(e=f.a.MacroBrowser.getMacroMetadata(this.warningData.macro).title),e?o.a.trigger("ic:error",n.format("We can\u0027\u0027t add an inline comment because the selected text includes the {0} macro. We\u0027\u0027ll add it as a page comment instead.",e)):o.a.trigger("ic:error","We can\u0027t add an inline comment to this content. We\u0027ll add it as a page comment instead.");break}}this.focusEditor()}else"pageComment"===this.type&&(o.a.trigger("ic:error","We can\u0027t add an inline comment to this content. We\u0027ll add it as a page comment instead."),this.focusEditor());this.captchaManager=new f.a.Confluence.QuickEditCaptchaManager(f.a.Confluence.EditorLoader.getEditorForm())},renderEditorFail:function(e){const t={closeable:!0,callback:this.bindPageReloadLink};switch(this.type){case"pageComment":this._setEditorIsNotDirty();break;case"topLevel":this.$(".loading-container").hide(),this.$(".ic-create-comment").hide(),t.closeable=!1;break;case"edit":case"reply":this.finish()}let i;switch(e){case"READ_ONLY":t.closeable=!1,i="This site is read-only. You can\u0027t make changes right now.";break;default:i=n.format("The editor didn\u0027\u0027t load properly. Please {0}reload the page{1} to try again.",'<a href="#" class="ic-reload-page">',"</a>")}o.a.trigger("ic:error",i,t),o.a.trigger("ic:editor:load:fail")},bindPageReloadLink:function(){m()(".ic-error").off("click",".ic-reload-page").on("click",".ic-reload-page",(function(){return window.location.reload(),!1}))},discardComment:function(e){null==e||e.preventDefault(),o.a.trigger("ic:clearError"),this.finish()},_getContent:function(){return Object(h.m)().RICH_TEXT_EDITOR?null===(e=Object(h.n)())||void 0===e?void 0:e.getContent():this.$("textarea").val();var e},focusEditor:function(){if(Object(h.m)().RICH_TEXT_EDITOR)if("pageComment"===this.type){var e,t,i;const n=m()(null===(e=Object(h.n)())||void 0===e?void 0:e.getBody()).find("div")[0];null===(t=Object(h.n)())||void 0===t||t.selection.select(n,!0),null===(i=Object(h.n)())||void 0===i||i.selection.collapse(!0),n.focus()}else{var n;null===(n=Object(h.n)())||void 0===n||n.focus()}else this.$(".ic-textarea:visible").focus()},destroy:function(){Object(h.m)().RICH_TEXT_EDITOR&&se(),this.remove()},beforeSendAjax:function(e){const t=this.captchaManager.getCaptchaData();t&&t.id&&(e.setRequestHeader("X-Atlassian-Captcha-Id",t.id),e.setRequestHeader("X-Atlassian-Captcha-Response",t.response))},showCaptchaError:function(e){return!(404!==e.status||!e.responseText||-1==e.responseText.search(/captcha/i))&&(this.captchaManager.refreshCaptcha(),this._triggerError("The typed word did not match the text in the picture.",{}),!0)}});const he=e=>{let{authorUserName:t,authorAvatarUrl:i,authorDisplayName:n,body:s,hasDeletePermission:o,hasEditPermission:a,lastModificationDate:r,commentDateUrl:c,resolved:l,darkFeatures:d}=e;return x.a.createElement(x.a.Fragment,null,x.a.createElement(S,{authorUserName:t,authorAvatarUrl:i,authorDisplayName:n}),x.a.createElement("div",{className:"ic-body wiki-content"},x.a.createElement("div",{className:"ic-content ic-reply-content",dangerouslySetInnerHTML:{__html:s}})),null!=d&&d.INLINE_COMMENTS&&!l?x.a.createElement(ue,{hasDeletePermission:o,hasEditPermission:a,lastModificationDate:r,commentDateUrl:c}):x.a.createElement("div",null,x.a.createElement(L,{time:r,commentUrl:c,displayLink:!Object(h.A)()})))},ue=e=>{let{hasDeletePermission:t,hasEditPermission:i,lastModificationDate:s,commentDateUrl:o}=e;return x.a.createElement("div",{className:"ic-actions"},x.a.createElement("ul",null,t&&x.a.createElement("li",null,x.a.createElement(T.a,{text:"Delete",type:"link",extraClasses:"ic-action-delete-reply"})),i&&!Object(h.A)()&&x.a.createElement("li",null,x.a.createElement(T.a,{text:"Edit",type:"link",extraClasses:"ic-action-edit-reply"})),x.a.createElement("li",{className:"ic-action-like-reply"}),x.a.createElement("li",{className:"ic-date"},x.a.createElement(L,{time:s,commentUrl:o,displayLink:!Object(h.A)()}))))},pe=e=>{let{totalReplies:t}=e;return x.a.createElement("div",{id:"ic-showmore-container"},x.a.createElement("div",{className:"ic-decor-line"}),x.a.createElement("div",{className:"ic-decor-line"}),x.a.createElement("div",{className:"ic-collapse-decor-center"},x.a.createElement("span",null,n.format("{0} more replies",t))))};var ge=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/display-reply/display-reply.scss"),ve={insert:"head",singleton:!1};N()(ge.a,ve),ge.a.locals;var fe=o.a.View.extend({tagName:"div",className:"ic-display-reply",template:e=>x.a.createElement(he,e),events:{"click .ic-action-edit-reply":"editReply","click .ic-action-delete-reply":"confirmDelete"},initialize:function(){p.a.bindAll(this,"onEditCallback"),this.$el.attr("data-comment-id",this.model.get("id"))},render:function(){const e=p.a.extend(this.model.toJSON(),{resolved:this.options.resolved,darkFeatures:Object(h.m)()});"READ_ONLY"===X.a.get("render-mode")&&(e.hasEditPermission=!1,e.hasDeletePermission=!1);const t=this.template(e);return this.$el.html(E.a.renderToStaticMarkup(t)),this._renderLikes(),this},_renderLikes:function(){this.likesView&&this.likesView.remove(),this.likesView=new W({contentId:this.model.id}).render(),this.likesView.$el.is(":empty")?this.$(".ic-action-like-reply").remove():this.$(".ic-action-like-reply").html(this.likesView.el)},editReply:function(e){if(Object(h.c)()){Object(h.q)(this.model.get("id")).done(e=>{this.editView=new me({model:this.model,type:"edit",selection:{},onFinished:this.onEditCallback,commentText:e}),this.$el.html(this.editView.$el),this.editView.render()}).fail((function(){o.a.trigger("ic:error","We can\u0027t edit this reply. The reply might have been deleted.")}))}else{var t,i;null==e||null===(t=e.currentTarget)||void 0===t||null===(i=t.blur)||void 0===i||i.call(t)}},onEditCallback:function(){this.editView&&this.editView.destroy(),this.editView=null,this.render()},deleteFail:function(e,t){switch(t.status){case 401:o.a.trigger("ic:error","You don\u0027t have permission to delete this comment.");break;case 405:if(t.responseText){if("READ_ONLY"===JSON.parse(t.responseText).reason){o.a.trigger("ic:error","This site is read-only. You can\u0027t make changes right now.");break}}break;default:o.a.trigger("ic:error","Could not complete your request.")}},confirmDelete:function(e){!0===window.confirm("Are you sure you want to delete this reply?")&&this.deleteReply(e),e.preventDefault()},deleteReply:function(e){m()(e.target).attr("aria-disabled",!0).prop("disabled",!0),this.model.destroy({wait:!0,error:this.deleteFail,success:function(){o.a.trigger("ic:reply:delete")}})},destroy:function(){this.likesView&&this.likesView.remove(),this.editView&&this.editView.destroy(),this.remove()}});var be=o.a.View.extend({tagName:"div",className:"ic-replies",events:{"click #ic-showmore-container":"forceShowAllReplies"},initialize:function(e){if(!e.commentModel)throw new Error("Inline Comment Model should be passed as a parameter when init ReplyListView","ReplyListView");this.replyViews=[],this.collection=e.commentModel.replies,this.source=e.source,this.listenTo(this.collection,"add remove",this.render),!0!==this.collection.isFetched&&(this.listenToOnce(this.collection,"sync",this.fetchComplete),this.collection.fetch({reset:!0})),this.expandReplies=!1,this.COMMENT_NUMBER_TO_COLLAPSE=4},fetchComplete:function(){this.collection.isFetched=!0,this.render(),Object(h.I)(this.$el)},render:function(e){return!0!==this.collection.isFetched?this:e&&this.collection.last()===e?void this.appendReply(e):(this.cleanUpReplyViews(),this.$el.empty(),this.collection.length>this.COMMENT_NUMBER_TO_COLLAPSE&&!1===this.expandReplies&&"permalink"!==this.source&&this.options.commentModel&&!this.options.commentModel.isResolved()?this.renderCollapsibleReplies():this.renderFullReplies(),this.trigger("ic:reply-rendered",this.options.commentModel),this._hightlightReply(),y.a.trigger("ic-jim-async-supported"),this)},renderFullReplies:function(){this.collection.each(e=>{this.appendReply(e)},this)},forceShowAllReplies:function(){this.expandReplies=!0,this.render()},renderCollapsibleReplies:function(){this.renderExpendButton();const e=this.collection.last();this.appendReply(e)},appendReply:function(e){const t=this.createReplyView(e);this.replyViews.push(t),this.$el.append(t.render().el)},renderExpendButton:function(){this.$el.append(E.a.renderToStaticMarkup(x.a.createElement(pe,{totalReplies:this.collection.length-1})))},createReplyView:function(e){return new fe({model:e,resolved:this.options.commentModel.isResolved()})},_hightlightReply:function(){if("permalink"!==this.source)return;const e=window.location.search.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null==e)return;const t=parseInt(e[2],10);t&&0!==t&&this.$(`[data-comment-id=${t}]`).addClass("ic-comment-reply-highlight")},cleanUpReplyViews:function(){for(let e=0;e<this.replyViews.length;e++)this.replyViews[e].destroy(),this.replyViews[e]=null;this.replyViews=[]},destroy:function(){this.cleanUpReplyViews(),this.remove()}}),ye=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/resolved-comment/resolved-comment.scss"),we={insert:"head",singleton:!1};N()(ye.a,we),ye.a.locals;var xe=o.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:e=>x.a.createElement(z,e),events:{"click .ic-action-unresolve":"unresolveComment","click .ic-action-show-reply":"showReply"},initialize:function(){p.a.bindAll(this,"onUnresolveComplete","destroy"),this.replyListView=new be({commentModel:this.model}),this.listenTo(this.replyListView,"ic:reply-rendered",()=>{this.renderNumberOfReplies()})},render:function(){const e=this.template(p.a.extend(this.model.toJSON(),{showMenu:!1,isDangling:this.model.isDangling(),darkFeatures:Object(h.m)(),hasReply:this.model.replies.length>0}));return this.$el.html(E.a.renderToStaticMarkup(e)),this.likesView&&this.likesView.remove(),this.likesView=new W({contentId:this.model.id,showLikeButton:!1}).render(),this.$(".ic-action-like").html(this.likesView.el),this.$el.append(this.replyListView.$el.hide()),this.replyListView.render(),this},unresolveComment:function(){o.a.trigger("ic:resolvedClearError"),this.model.resolve(!1,{wait:!0,success:this.onUnresolveComplete,error:this.onUnresolveFail})},onUnresolveComplete:function(){o.a.trigger("ic:unresolved"),this.$el.slideUp(this.destroy)},onUnresolveFail:function(e,t){switch(t.status){case 401:o.a.trigger("ic:resolvedError","You don\u0027t have permission to resolve this comment.");break;case 405:"READ_ONLY"===JSON.parse(t.responseText).reason?o.a.trigger("ic:resolvedError","This site is read-only. You can\u0027t make changes right now."):o.a.trigger("ic:resolvedError","Could not complete your request.");break;default:o.a.trigger("ic:resolvedError","Could not complete your request.")}},showReply:function(){this.$(".ic-action-show-reply").parent().remove(),this.$(".ic-replies").slideDown()},renderNumberOfReplies:function(){const e=this.model.replies.length,t=this.$(".ic-action-show-reply");if(e>0){let i;i=1===e?n.format("{0} reply",1):n.format("{0} replies",e),t.text(i),t.parent().removeClass("hidden")}else t.parent().remove()},destroy:function(){this.replyListView.destroy(),this.remove()}});const ke=e=>{let{layer:t}=e;return x.a.createElement(T.b,{id:"ic-resolved-comment-dialog",removeOnHide:!0,extraClasses:"ic-resolved-comment-dialog-content",modal:!0,titleText:"Resolved comments",footerActionContent:x.a.createElement(T.a,{id:"resolved-dialog-close-button",text:"Close",type:"link"}),content:x.a.createElement("div",{id:"ic-resolved-comment-dialog-error"}),layer:t})},Ee=()=>x.a.createElement(x.a.Fragment,null,x.a.createElement("p",null,"Got more to say? You can reopen resolved comments to continue the discussion."),x.a.createElement(T.a,{id:"ic-resolved-discovery-dismiss",type:"link",text:"OK, got it"}));var Ce=o.a.View.extend({events:{"click #resolved-dialog-close-button":"destroy"},template:e=>x.a.createElement(ke,e),initialize:function(){p.a.bindAll(this,"render","destroy","_onKeyDown"),this._resolvedCommentViews=[],this.listenTo(this.collection,"change:resolveProperties",this.onResolvedChanged),this.listenTo(o.a,"ic:resolvedError",this.displayError),this.listenTo(o.a,"ic:resolvedClearError",this.clearErrors);const e=this.template(),t=m()(E.a.renderToStaticMarkup(e));this.setElement(t),this.dialog=f.a.dialog2(this.$el),m()(document).bind("keydown",this._onKeyDown),y.a.trigger("remove-bindings.keyboardshortcuts")},render:function(){const e=m()("<div>"),t=this.collection.getResolvedCount();return 0!==t?p.a.each(this.collection.getResolvedCommentsDesc(),t=>{const i=new xe({model:t});this._resolvedCommentViews.push(i),e.append(i.render().$el)},this):this.displayNoCommentMessage(),this.$(".aui-dialog2-content").append(e),this.dialog.show(),this.options.focusCommentId&&this.scrollToComment(this.options.focusCommentId),o.a.trigger("ic:resolved:view",t),y.a.trigger("ic-jim-async-supported"),this},onResolvedChanged:function(){0===this.collection.getResolvedCount()&&this.displayNoCommentMessage()},displayNoCommentMessage:function(){f.a.messages.generic(this.$(".aui-dialog2-content"),{body:"There are no resolved comments on this page.",closeable:!1})},displayError:function(e){this.clearErrors(),f.a.messages.error(this.$("#ic-resolved-comment-dialog-error"),{body:e,closeable:!1})},clearErrors:function(){this.$("#ic-resolved-comment-dialog-error").empty()},scrollToComment:function(e){const t=this.$(f.a.format("[data-comment-id={0}]",e));if(t.length)return t.addClass("focused"),this.$(".aui-dialog2-content").animate({scrollTop:t.parent().position().top},100);return(new(m.a.Deferred())).reject()},_onKeyDown:function(e){this.$el&&this.$el.is(":visible")&&e.keyCode===f.a.keyCode.ESCAPE&&this.destroy()},destroy:function(){y.a.trigger("add-bindings.keyboardshortcuts"),m()(document).unbind("keydown",this._onKeyDown),this.dialog.hide(),this.dialog.remove(),p.a.each(this._resolvedCommentViews,(function(e){e.destroy()})),this._resolvedCommentViews=null,this.remove()}}),Te=i("confluence.web.components:core/require('confluence/hover-user')"),Oe=i.n(Te);function je(){return ee.a.activeEditor}var Ie=i("./src/main/frontend/loader/context/editor/index.ts");const Ne={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;","`":"&#96;"},_e=new RegExp(`[${Object.keys(Ne).join("")}]`,"g");i(4);var Ae=i("./src/main/frontend/loader/context/editor/cursorHandler.ts"),De=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/confirm-dialog/confirm-dialog.scss"),Re={insert:"head",singleton:!1};N()(De.a,Re),De.a.locals;const Ve=e=>{let{label:t,message:i}=e;return x.a.createElement(x.a.Fragment,null,x.a.createElement("strong",{className:"ic-confirm-label"},t),x.a.createElement("div",{className:"ic-confirm-message"},i),x.a.createElement("div",{className:"ic-confirm-buttons"},x.a.createElement(T.a,{text:"Delete",extraClasses:["ic-action-delete-confirm","aui-button-compact"]}),x.a.createElement(T.a,{text:"Cancel",type:"link",extraClasses:["ic-action-cancel-confirm","aui-button-compact"]})))};var Se=o.a.View.extend({tagName:"div",className:"ic-confirm-container",initialize:function(e){this.$menuEl=e.$menuEl,this.$bodyEl=e.$bodyEl,this.$menuEl.addClass("ic-action-menu-active"),this.render(),p.a.bindAll(this,"clickOutside"),this.$bodyEl.on("click",this.clickOutside)},events:{"click .ic-action-cancel-confirm":"cancel","click .ic-action-delete-confirm":"confirm"},template:e=>x.a.createElement(Ve,e),render:function(){return this.$el.html(E.a.renderToStaticMarkup(this.template(this.model.toJSON()))),this},clickOutside:function(e){m.a.contains(this.el,e.target)||this.el===e.target||this.cancel()},cancel:function(){this.destroy()},confirm:function(){this.trigger("ic:confirm"),this.destroy()},destroy:function(){this.$bodyEl.off("click",this.clickOutside),this.$menuEl.removeClass("ic-action-menu-active"),this.remove()}}),Le=i("./src/main/frontend/model/comment-collection.ts"),Me=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/navigation/navigation.scss"),Ue={insert:"head",singleton:!1};N()(Me.a,Ue),Me.a.locals;var Pe=o.a.View.extend({tagName:"div",events:{"click #ic-nav-previous":"showPrevious","click #ic-nav-next":"showNext"},template:e=>x.a.createElement(j,e),initialize:function(){this.model.collection||(this.model.collection=Le.a),this.collection=this.model.collection,this.listenTo(this.collection,"change:resolveProperties",this.onResolveToggle),this.disabled=this.collection.getCommentsOnPageCount()<=1,this.isViewMode=!Object(h.A)(),this.isMacOS=Object(h.C)(),this.listenTo(o.a,"ic:show-previous",this.showPrevious),this.listenTo(o.a,"ic:show-next",this.showNext)},render:function(){return this.$el.html(E.a.renderToStaticMarkup(this.template({disabled:this.disabled,showIndex:!(this.model.isResolved()||this.model.get("deleted")),index:this.collection.getActiveIndexWithinPageComments()+1,size:this.collection.getCommentsOnPageCount(),isViewMode:this.isViewMode,isMacOS:this.isMacOS}))),this},onResolveToggle:function(){this.disabled=this.collection.getCommentsOnPageCount()<=1,this.render()},showPrevious:function(){if(this.disabled)return;const e=this.collection.getPrevCommentOnPage();null!=e&&o.a.trigger("ic:view",e,"nav")},showNext:function(){if(this.disabled)return;const e=this.collection.getNextCommentOnPage();null!=e&&o.a.trigger("ic:view",e,"nav")}});var $e=o.a.View.extend({DIALOG_BACKGROUND_COLOR:"#ffffff",DIALOG_BORDER_COLOR:"#f79232",initialize:function(){p.a.bindAll(this,"getDiscoveryDialogContent","destroy","onEndScroll")},template:e=>x.a.createElement(Ee,e),show:function(){m.a.when(this.scrollTop()).done(this.onEndScroll)},onEndScroll:function(){this.showToolsMenu(),this._discoveryDialog=this.createDiscoveryDialog(),this._discoveryDialog.show()},showToolsMenu:function(){const e=m()("#action-menu");e.on("aui-dropdown2-hide",this.destroy),m()("#action-menu-link").trigger("aui-button-invoke"),e.find("a.active").removeClass("active");const t=e.find("#view-resolved-comments").addClass("active");setTimeout((function(){t.focus()}))},createDiscoveryDialog:function(){const e={gravity:"w",hideCallback:this.destroy,width:280,noBind:!0},t=f.a.InlineDialog(m()("#view-resolved-comments"),"ic-resolved-dialog-discovery",this.getDiscoveryDialogContent,e);return t.on("click focusin mousedown",(function(e){e.stopPropagation()})),t},getDiscoveryDialogContent:function(e,t,i){const n=this.template();return e.html(E.a.renderToStaticMarkup(n)),e.find("#ic-resolved-discovery-dismiss").on("click",()=>{o.a.trigger("ic:resolved:dismiss:recovery"),this._discoveryDialog.hide()}),i(),!1},scrollTop:function(){const e=m()("#splitter-content"),t=!!e.length?e:m()("html, body"),i=0===t.scrollTop()?1:300;return t.animate({scrollTop:0},i)},destroy:function(){const e=m()("#action-menu");e.off("aui-dropdown2-hide"),e.is(":visible")&&m()("#action-menu-link").trigger("aui-button-invoke"),this._discoveryDialog.remove(),this.remove()}}),Fe=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/display-comment/display-comment.scss"),He={insert:"head",singleton:!1};N()(Fe.a,He),Fe.a.locals;var ze=o.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:e=>x.a.createElement(M,e),events:{"click .ic-action-reply":"replyComment","click .ic-action-resolve":"resolveComment","click .ic-action-edit":"editComment","click .ic-action-delete":"confirm","click #show-resolved-comments":"showResolvedDialogDiscovery","click .ic-reply-placeholder .textarea":"replyComment","focus .ic-reply-container .textarea":"onReplyPlaceholderFocus","keyup .ic-reply-container .textarea":"onReplyPlaceholderType"},initialize:function(e){if(p.a.bindAll(this,"confirm","destroy","deleteFail","replyComment","resolveComment","editComment","renderCommentOnly"),this.model.set("active",!0),this.listenTo(this.model,"change:resolveProperties",this.render),parseInt(f.a.version)<9){const e=m()("body");e.on("click",".ic-action-delete a",this.confirm),e.on("click",".ic-action-reply a",this.replyComment),e.on("click",".ic-action-resolve a",this.resolveComment),e.on("click",".ic-action-edit a",this.editComment)}this.replyListView=new be({commentModel:this.model,source:e.source})},render:function(){const e=p.a.extend(this.model.toJSON(),{showMenu:"READ_WRITE"===X.a.get("render-mode")&&!Object(h.A)(),currentAuthorUserName:X.a.get("remote-user"),currentAuthorAvatarUrl:Object(h.i)(),currentAuthorDisplayName:Object(h.j)(),darkFeatures:Object(h.m)()});return Object(h.A)()&&(e.hasEditPermission=!1,e.hasReplyPermission=!1),this.$el.html(E.a.renderToStaticMarkup(this.template(e))),this.model.isResolved()?this.$(".ic-comment-container").addClass("ic-resolved"):this.$(".ic-list").append(this.replyListView.render().el),this._renderNavigation(),this._renderLikes(),Object(h.a)(this),this},_renderNavigation:function(){this.navigationView&&this.navigationView.remove(),this.navigationView=new Pe({model:this.model}),this.navigationView.render(),this.$("#ic-nav-container").html(this.navigationView.el)},_renderLikes:function(){this.likesView&&this.likesView.remove(),this.likesView=new W({contentId:this.model.id}).render(),this.likesView.$el.is(":empty")?this.$(".ic-action-like").remove():this.$(".ic-action-like").html(this.likesView.el)},editComment:function(e){if(e.preventDefault(),this.editView)this.editView.focusEditor();else if(Object(h.c)()){Object(h.q)(this.model.get("id")).done(e=>{this.editView=new me({model:this.model,type:"edit",selection:{},onFinished:this.renderCommentOnly,commentText:e}),this.$(".ic-display-comment").html(this.editView.$el),this.editView.render()}).fail(()=>{o.a.trigger("ic:error","We can\u0027t edit this comment. The comment might have been deleted.")})}},renderCommentOnly:function(){this.editView&&this.editView.destroy(),this.editView=null;const e=p.a.extend(this.model.toJSON(),{darkFeatures:Object(h.m)()});this.$(".ic-display-comment").html(m()(E.a.renderToStaticMarkup(x.a.createElement(z,e))).children()),this._renderLikes()},replyComment:function(e){var t,i;(e&&e.preventDefault(),this.createReplyView)?this.createReplyView.focusEditor():Object(h.c)()?(this.createReplyView=new me({model:this.model,type:"reply",onFinished:p.a.bind(()=>{this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null},this)}),this.$(".ic-reply-container").prepend(this.createReplyView.$el),this.createReplyView.render()):null==e||null===(t=e.currentTarget)||void 0===t||null===(i=t.blur)||void 0===i||i.call(t)},confirm:function(e){if(e.preventDefault(),e.stopImmediatePropagation(),this.model.replies.length>0)return o.a.trigger("ic:error","You can\u0027t delete inline comment threads with replies."),!1;const t=new Se({model:new o.a.Model({label:"Delete",message:"Are you sure you want to delete the comment?"}),$menuEl:m()(".ic-action-menu"),$bodyEl:m()("body")});this.$(".ic-sidebar-heading").append(t.$el),this.listenTo(t,"ic:confirm",this.deleteComment),Object(h.A)()&&Object(h.J)()},deleteComment:function(){const e=p.a.bind(()=>{var e;this.$el.html(E.a.renderToStaticMarkup(x.a.createElement(U,null))),this.model.set("deleted",!0),this._renderNavigation(),Object(h.H)(this.model.highlights),Object(h.a)(this),o.a.trigger("ic:delete"),Object(h.A)()&&(this.model.set("active",!1),this.model.set("editorActive",!0)),Object(Ae.b)(),null===(e=Object(h.n)())||void 0===e||e.focus()},this);this.model.destroy({wait:!0,success:e,error:this.deleteFail})},deleteFail:function(e,t){var i;switch(t.status){case 401:o.a.trigger("ic:error","You don\u0027t have permission to delete this comment.");break;case 405:if(t.responseText){"READ_ONLY"===JSON.parse(t.responseText).reason&&o.a.trigger("ic:error","This site is read-only. You can\u0027t make changes right now.")}else o.a.trigger("ic:error","Could not complete your request.");break;case 409:o.a.trigger("ic:error",t.responseText);break;default:o.a.trigger("ic:error","Could not complete your request.")}null===(i=Object(h.n)())||void 0===i||i.focus()},destroy:function(e){if(parseInt(f.a.version)<9){const e=m()("body");e.off("click",".ic-action-delete a",this.confirm),e.off("click",".ic-action-reply a",this.replyComment),e.off("click",".ic-action-resolve a",this.resolveComment),e.off("click",".ic-action-edit a",this.editComment)}this.createReplyView&&this.createReplyView.destroy(),this.editView&&this.editView.destroy(),this.replyListView.destroy(),this.navigationView&&this.navigationView.remove(),this.likesView&&this.likesView.remove(),!e&&this.remove()},resolveComment:function(e){null==e||e.preventDefault(),Object(h.c)(!0)&&this.model.resolve(!0,{wait:!0,success:p.a.bind(this.onResolveComplete,this),error:this.onResolveFail})},onResolveComplete:function(){var e;this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null,o.a.trigger("ic:resolved"),Object(h.H)(this.model.highlights),null===(e=Object(h.n)())||void 0===e||e.focus()},onResolveFail:function(e,t){var i;switch(t.status){case 401:o.a.trigger("ic:error","You don\u0027t have permission to resolve this comment.");break;case 405:if(t.responseText){"READ_ONLY"===JSON.parse(t.responseText).reason&&o.a.trigger("ic:error","This site is read-only. You can\u0027t make changes right now.")}break;default:o.a.trigger("ic:error","Could not complete your request.")}null===(i=Object(h.n)())||void 0===i||i.focus()},showResolvedDialogDiscovery:function(){(new $e).show(),o.a.trigger("ic:resolved:show:recovery")},onReplyPlaceholderFocus:function(e){if(Object(h.m)().RICH_TEXT_EDITOR){var t,i;const n=-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome");("READ_ONLY"===X.a.get("access-mode")||n)&&(null==e||null===(t=e.currentTarget)||void 0===t||null===(i=t.blur)||void 0===i||i.call(t))}},onReplyPlaceholderType:function(e){if("READ_ONLY"===X.a.get("access-mode")){const t=m()(e.currentTarget);t.val(""),t.blur()}}}),qe=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js?!./src/main/frontend/view/sidebar/sidebar.scss"),Be={insert:"head",singleton:!1};N()(qe.a,Be),qe.a.locals;var Xe=o.a.View.extend({tagName:"div",className:"ic-sidebar",events:{"click button.ic-action-hide":function(e){this.hide(e,!0),o.a.trigger("ic:sidebar:close")},wheel:function(e){var t,i,n,s,o,a;Object(h.A)()&&(null===(t=je())||void 0===t||null===(i=t.getWin())||void 0===i||i.scrollTo((null===(n=je())||void 0===n||null===(s=n.getWin())||void 0===s?void 0:s.scrollX)+e.originalEvent.deltaX,(null===(o=je())||void 0===o||null===(a=o.getWin())||void 0===a?void 0:a.scrollY)+e.originalEvent.deltaY))}},initialize:function(e){this.listenTo(o.a,"ic:view ic:overlap",this.displayComment),this.listenTo(o.a,"ic:create",this.displayCreateComment),this.listenTo(o.a,"ic:error",this.displayError),this.listenTo(o.a,"ic:hide-sidebar",this.hide),this.listenTo(o.a,"ic:clearError",this.clearError),Object(h.m)().RICH_TEXT_EDITOR?y.a.bind("rte-quick-edit-ready",()=>{const e=this.$el.find("#wysiwygTextarea_ifr");if(0!==e.length){var t;new MutationObserver((function(){e.resize()})).observe(e[0],{attributes:!0,attributeFilter:["style"]}),null!==(t=je())&&void 0!==t&&t.getContent()||this._scrollToEditorView(e)}else{this.$el.is(":visible")||(Object(h.t)(Object(h.A)()).css("padding-right","0"),this.$wikiContent.css("position","static"),Object(h.t)(Object(h.A)()).css({"min-height":0}))}}):y.a.bind("init.rte",p.a.bind(this.hideInEditMode,this)),this.defaultNavOffset=130,this.defaultPermalinkedCommentOffset=100,this.$wikiContent=e.$wikiContent||m()("#content .wiki-content").first(),this.sidebarObserver=new MutationObserver(p.a.bind(this.setSidebarYPos,this)),this.sidebarObserver.observe(this.el,{childList:!0,subtree:!0}),m()(window).resize(p.a.debounce(p.a.bind(this.setSidebarYPos,this),100)),y.a.bind("sidebar.expanded sidebar.collapsed",p.a.debounce(p.a.bind(this.setSidebarYPos,this),50))},displayComment:function(e,t,i){const n=function(){if(e.highlight.is(":hidden")&&(Object(h.N)(e.highlight),e.highlight.is(":hidden")))return;this.distanceToTop=this.previousHighlightOffset||this.defaultNavOffset,this._emptySidebar(!0),this.commentView=new ze({model:e,source:t}),this.show(!0);let n=e.highlight;for(this.previousHighlightOffset=n.position().top;n.offsetParent().hasClass("conf-macro output-block");)n=n.offsetParent(),this.previousHighlightOffset+=n.position().top;const s=this.commentView.render().$el;s.css("visibility","hidden"),"nav"===t?Object(h.A)()?Object(h.J)():this._scrollToComment(e):"permalink"===t?this._scrollToPermalinkedComment(e,this.defaultPermalinkedCommentOffset,i):"quickreload"===t&&this._scrollToQuickReloadComment(e),this.$el.html(s),Oe()()};void 0===i||!1===i.ignoreConfirmDialog?Object(h.c)(!0)&&n.call(this):n.call(this),y.a.trigger("ic-jim-async-supported")},_scrollToQuickReloadComment:function(e){const t=m()(".qr-feedback:first");let i=this.defaultPermalinkedCommentOffset;t.length>0&&(i=t.height()+67),this._scrollToPermalinkedComment(e,i)},_scrollToEditorView:function(e){const t=Object(h.z)()?Object(h.u)():m()("body, html"),i=this.$(".ic-display-comment-view").position().top,n=e.closest(".ic-create-comment-view").position().top+i;((null==t?void 0:t.height())<n||(null==t?void 0:t.scrollTop())>n)&&t.animate({scrollTop:n},100)},_scrollToPermalinkedComment:function(e,t,i){let n;if(Object(h.z)()){const s=40;n=e.highlight.offset().top+Object(h.u)().scrollTop()-s,Object(h.u)().animate({scrollTop:n-t},100).promise().done(p.a.bind(this._scrollToPermalinkedCommentCompleted,this,i))}else n=e.highlight.offset().top,m()("html, body").animate({scrollTop:n-t},100).promise().done(p.a.bind(this._scrollToPermalinkedCommentCompleted,this,i))},_scrollToPermalinkedCommentCompleted:function(e){e&&e.isReplyComment&&this.commentView.replyComment()},_scrollToComment:function(e){let t=e.highlight,i=t.position().top;for(;t.offsetParent().hasClass("conf-macro output-block");)t=t.offsetParent(),i+=t.position().top;Object(h.z)()?Object(h.u)().animate({scrollTop:Object(h.u)().scrollTop()+i-this.distanceToTop},100):m()("html, body").animate({scrollTop:window.pageYOffset+i-this.distanceToTop},100)},displayCreateComment:function(e,t,i){const n=this.warningData(),s=null===n;var o;this._emptySidebar(!0),this.createCommentView=new me({collection:e,selection:t,type:s?"topLevel":"pageComment",warningData:n,isFocus:!1,stopFocus:!0,commentText:s?"":"<blockquote>"+(o=t.text,o.replace(_e,e=>Ne[e])+"</blockquote> <div></div>"),onFinished:()=>{this.createCommentView.keepSidebar||this.isShowing&&this.hide()},serializedHighlights:i}),this.show(),this.createCommentView.$el.css("visibility","hidden"),this.$el.html(this.createCommentView.$el),this.createCommentView.render()},warningData:function(){const e=m()(".ic-current-selection"),t=Object(h.g)(e);return t?{type:"unsupportedMacro",macro:t}:Object(h.f)(e)?{type:"internalLink"}:Object(h.h)(e)?{type:"mention"}:Object(h.d)(e)?{type:"dateLozenge"}:null},displayError:function(e,t){t=p.a.extend({closeable:!1},t),this.clearError(),function(e,t){window.AJS.messages.error(".ic-error",{body:e,closeable:t})}(e,t.closeable),t.callback&&t.callback()},clearError:function(){m()(".ic-error").empty()},show:function(e){this.isShowing||(this._toggleSidebar(e),this.isShowing=!0)},hideInEditMode:function(e){"comment"!==X.a.get("content-type")&&(this.sidebarObserver.disconnect(),this.hide(e))},hide:function(e,t){if(null==e||e.preventDefault(),Object(h.c)(!0)){var i;if(!this.isShowing){var n,s;const t=null==e?void 0:e.currentTarget;return void(null!=t&&null!==(n=t.classList)&&void 0!==n&&n.contains("active")&&(null==t||null===(s=t.classList)||void 0===s||s.remove("active")))}Object(h.t)(Object(h.A)()).css({"min-height":"initial"}),this._toggleSidebar(!Object(h.A)()&&t),o.a.trigger("ic:sidebar-hidden"),this.isShowing=!1,null===(i=Object(h.n)())||void 0===i||i.focus()}},_toggleSidebar:function(e){const t=m()(".inline-comment-marker.active:first, .ic-current-selection:first");let i;const n=Object(h.z)()?Object(h.u)().scrollTop():window.pageYOffset;var s;t.length>0&&(i=((null===(s=t.offset())||void 0===s?void 0:s.top)||0)-(n||0));const o=m.a.Deferred();let a=o.promise();this.isShowing?e&&Object(h.y)()?a=Object(h.b)(this,!1):(Object(h.t)(Object(h.A)()).css("padding-right","0"),this.$wikiContent.css("position","static"),this._emptySidebar(),o.resolve()):(Object(h.t)(Object(h.A)()).css("padding-right","280px"),e&&Object(h.y)()?a=Object(h.b)(this,!0):o.resolve(),this.$wikiContent.css("position","relative")),a.done((function(){Object(h.A)()||Object(h.K)(i,t)}))},_emptySidebar:function(e){this.commentView&&(this.commentView.model.unset&&this.commentView.model.unset("active"),this.commentView.destroy(),this.commentView=null),this.createCommentView&&(this.createCommentView.keepSidebar=e,this.createCommentView.destroy(),this.createCommentView=null)},setSidebarYPos:function(){if(!this.isShowing)return;const e=this.$el.offset().top;let t,i;if(null!=this.commentView)t=this.commentView.$el,i=this.commentView.model.highlight;else{if(null==this.createCommentView)return;t=this.createCommentView.$el,i=m()(".ic-current-selection")}if(!i)return;const n=i.offset().top-e+(Object(h.A)()?Object(h.r)()-i.height():0)+"px",s={visibility:"visible",position:"absolute",top:n};var o;(Object(h.A)()&&(s.right="20px",s.borderRight="1px solid #ccc",s.position="fixed"),t.css(s),Object(h.A)())?(Object(Ie.setOriginalPos)(n),null===(o=Object(h.G)(t))||void 0===o||o.then(e=>{Object(h.O)(n),e&&Object(h.J)()})):Object(h.G)(t)}}),Ye=i("./src/main/frontend/loader/highlightTextView.ts");i(0),i(5);let Qe,Je;const Ke={init:function(e){var t;Qe=e,Je&&o.a.trigger("ic:hide-sidebar"),Je=new Xe({$wikiContent:Object(h.k)()}),Object(h.t)().append(Je.$el),null===(t=Qe)||void 0===t||t.reInitHighlights(),Object(Ye.b)(Qe),Object(h.D)()||g.isLikable()||l.a&&l.a.Likes&&l.a.Likes.getLikesCache&&l.a.Likes.getLikesCache().done((function(e){g.init(e),o.a.trigger("ic:likes-received")})),Object(h.m)().INLINE_COMMENTS},loadSidebarOnClick:function(e){if(Object(h.c)()){o.a.trigger("ic:highlight-panel-click"),m()(".inline-comment-marker").removeClass("active");const t=Object(h.F)(e,Qe);if(t){const e=m()('.inline-comment-marker[data-ref="'+t.get("markerRef")+'"]');l.a.HighlightAction.clearTextSelection(),t.highlight=e,o.a.trigger("ic:overlap",t)}else{const t=(new r.a).removeHighlight().highlight(e.range);o.a.trigger("ic:create",Qe,e,t)}}},updateResolvedCommentCountInToolsMenu:function(){var e;m()("#view-resolved-comments>span").text("Resolved comments"+` (${null===(e=Qe)||void 0===e?void 0:e.getResolvedCount()})`)},afterSyncCommentCollection:function(){var e,t;null===(e=Qe)||void 0===e||e.once("sync",e=>{this.displayPermalinkedComment(e)}),null===(t=Qe)||void 0===t||t.on("change:resolveProperties",()=>{this.updateResolvedCommentCountInToolsMenu()}),this.updateResolvedCommentCountInToolsMenu()},displayPermalinkedComment:function(e){const t=window.location.search;Object(h.M)(e,t,Ce)},createResolvedCommentListView:function(){new Ce({collection:Qe}).render()}};t.default=Ke},2:function(e,t,i){e.exports=void 0},3:function(e,t,i){e.exports=void 0},4:function(e,t,i){e.exports=void 0},5:function(e,t,i){e.exports=void 0},"confluence.web.components:core/require('confluence/hover-user')":function(e,t){e.exports=require("confluence/hover-user")}}]);
}catch(e){WRMCB(e)};